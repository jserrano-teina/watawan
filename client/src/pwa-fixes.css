/* 
  PWA FIXES CSS - V2 PARA PROBLEMAS ESPECÍFICOS EN IOS
  Este archivo contiene soluciones para los problemas persistentes de layout en iOS
  - Espaciado extraño bajo la navbar
  - Contenido cortado en la parte superior
  - Problemas con modales
  - Problemas con sheets (comparte tu lista)
*/

/* ---------- RESETS GLOBALES BÁSICOS ---------- */
html, body, #root {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  background-color: #121212;
  color: white;
}

/* ---------- FIJACIÓN CRÍTICA DE VIEWPORT PARA PWA ---------- */
@media (display-mode: standalone), (display-mode: fullscreen) {
  /* ESTRUCTURA BÁSICA - NO TOCAR */
  html, body {
    height: 100%;
    width: 100%;
    overflow: hidden;
    position: fixed;
    margin: 0;
    padding: 0;
    -webkit-text-size-adjust: 100%;
    background-color: #121212;
  }
  
  /* Permitimos scroll SOLO en el root */
  #root {
    height: 100%;
    width: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    background-color: #121212;
    position: absolute;
    top: 0;
    left: 0;
    padding-top: env(safe-area-inset-top, 0);
    /* El bottom padding asegura espacio para la navbar + safe area */
    padding-bottom: calc(72px + env(safe-area-inset-bottom, 0));
  }
  
  /* FIX PARA PÁGINA CON SCROLL COMPLETO */
  .page-content {
    min-height: 100%;
    width: 100%;
    background-color: #121212;
    /* Eliminamos padding-bottom para evitar doble espacio */
    padding-bottom: 0 !important;
  }
  
  /* CONTENEDOR DE ALTURA FIJA PARA PÁGINAS CON POCO CONTENIDO */
  .fixed-height-container {
    min-height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #121212;
    /* Eliminamos padding-bottom para evitar doble espacio */
    padding-bottom: 0 !important;
  }
  
  /* ==== NAVEGACIÓN INFERIOR (FIX CRÍTICO) ==== */
  .fixed-navigation {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    /* Altura específica sin insets */
    height: 72px !important;
    min-height: 72px !important;
    max-height: 72px !important;
    background-color: #121212 !important;
    border-top: 1px solid #333 !important;
    z-index: 50 !important;
    /* ¡IMPORTANTE! Margen inferior SOLO es el safe-area-inset-bottom */
    padding-bottom: env(safe-area-inset-bottom, 0) !important;
    /* Forzamos que esté visible siempre */
    transform: translateZ(0);
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* ==== MODALES Y SHEETS (FIX ESPECÍFICO) ==== */
  /* Sheet de Radix UI necesita override específico */
  [data-radix-popper-content-wrapper] {
    /* Asegurar que llegue hasta arriba */
    top: 0 !important;
    /* Extender hasta abajo considerando safe area */
    max-height: calc(100% - env(safe-area-inset-bottom, 0)) !important;
    /* Forzar que sea visible en PWA */
    z-index: 999 !important;
    overflow: visible !important;
  }
  
  /* SheetContent específico para iOS */
  .ios-sheet-fix {
    /* Ajuste crítico para sheets en iOS */
    padding-top: env(safe-area-inset-top, 0) !important;
    padding-bottom: calc(env(safe-area-inset-bottom, 16px) + 16px) !important;
  }
  
  /* Fondo de modales y sheets */
  [data-radix-popper-content-wrapper] > div {
    background-color: #121212 !important;
  }
  
  /* Sheet animado desde abajo */
  [data-state="open"][data-side="bottom"] {
    animation: slideUpAndFade 0.3s ease-out !important;
  }
  
  /* Modal normal con contenido scrollable */
  .modal-content {
    padding-top: env(safe-area-inset-top, 0) !important;
    padding-bottom: env(safe-area-inset-bottom, 0) !important;
    /* Asegurar scroll suave */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  /* Botones en modales */
  .modal-actions {
    /* Agregar el safe-area-inset-bottom */
    padding-bottom: calc(16px + env(safe-area-inset-bottom, 0)) !important;
    background-color: #121212;
  }
  
  /* ==== UTILIDADES AUXILIARES ==== */
  /* Evitar selección de texto accidental */
  * {
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }
  
  /* Permitir seleccionar texto en inputs y textareas */
  input, textarea {
    user-select: text !important;
  }
  
  /* ==== ANIMACIONES ESPECÍFICAS ==== */
  @keyframes slideUpAndFade {
    from {
      opacity: 0;
      transform: translateY(100%);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* ==== SAFE AREA UTILITIES ==== */
  .safe-top {
    padding-top: env(safe-area-inset-top, 0) !important;
  }
  
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0) !important;
  }
  
  .safe-all {
    padding-top: env(safe-area-inset-top, 0) !important;
    padding-bottom: env(safe-area-inset-bottom, 0) !important;
    padding-left: env(safe-area-inset-left, 0) !important;
    padding-right: env(safe-area-inset-right, 0) !important;
  }
}

/* SOPORTE ESPECÍFICO PARA SAFARI iOS */
@supports (-webkit-touch-callout: none) {
  /* Overrides específicos para Safari en iOS */
  @media (display-mode: standalone), (display-mode: fullscreen) {
    /* Fix específico para sheet en Safari */
    [data-radix-popper-content-wrapper] {
      /* En Safari necesitamos ser más agresivos */
      inset: 0 !important;
      position: fixed !important;
      height: 100% !important;
      width: 100% !important;
    }
    
    /* Fix para modales con contenido scrollable */
    .modal-content, .ios-sheet-fix, .page-content {
      /* Safari necesita estas propiedades adicionales */
      overscroll-behavior-y: none !important;
      -webkit-overflow-scrolling: touch !important;
    }
    
    /* Safari específicamente tiene problemas con la navbar */
    .fixed-navigation {
      /* Forzar que nunca se oculte */
      bottom: 0 !important;
      transform: none !important;
      /* Color específico para evitar transparencias */
      background-color: #121212 !important;
    }
  }
  
  /* Soporte para detección manual de iOS standalone */
  html.standalone-mode body {
    position: fixed;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  html.standalone-mode #root {
    overflow-y: auto;
    height: 100%;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: none;
  }
}